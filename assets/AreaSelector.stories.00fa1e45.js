var rt=Object.defineProperty,st=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var V=(t,e,s)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,u=(t,e)=>{for(var s in e||(e={}))at.call(e,s)&&V(t,s,e[s]);if(F)for(var s of F(e))lt.call(e,s)&&V(t,s,e[s]);return t},w=(t,e)=>st(t,ot(e));import{j as X,r as b,a as p}from"./index.267f8182.js";const I={x:0,y:0,width:0,height:0,unit:"px"};function Z(t,e,s){return Math.min(Math.max(t,e),s)}function ct(t,e){return t.width===e.width&&t.height===e.height&&t.x===e.x&&t.y===e.y&&t.unit===e.unit}const G=(t,e,s,A)=>A==="pixel"?$(t,e,s):ht(t,e,s),ht=(t,e,s)=>t.unit==="%"?w(u(u({},I),t),{unit:"%"}):{unit:"%",x:t.x?t.x/e*100:0,y:t.y?t.y/s*100:0,width:t.width?t.width/e*100:0,height:t.height?t.height/s*100:0};function $(t,e,s){return t.unit?t.unit==="px"?w(u(u({},I),t),{unit:"px"}):{unit:"px",x:t.x?t.x*e/100:0,y:t.y?t.y*s/100:0,width:t.width?t.width*e/100:0,height:t.height?t.height*s/100:0}:w(u(u({},I),t),{unit:"px"})}function dt(t,e,s,A,C=0,Y=0,g=s,f=A){const i=u({},t);i.y<0&&(i.height=Math.max(i.height+i.y,Y),i.y=0),i.x<0&&(i.width=Math.max(i.width+i.x,C),i.x=0);const R=s-(i.x+i.width);R<0&&(i.x=Math.min(i.x,s-C),i.width+=R);const L=A-(i.y+i.height);return L<0&&(i.y=Math.min(i.y,A-Y),i.height+=L),i.width<C&&((e==="sw"||e=="nw")&&(i.x-=C-i.width),i.width=C),i.height<Y&&((e==="nw"||e=="ne")&&(i.y-=Y-i.height),i.height=Y),i.width>g&&((e==="sw"||e=="nw")&&(i.x-=g-i.width),i.width=g),i.height>f&&((e==="nw"||e=="ne")&&(i.y-=f-i.height),i.height=f),i}const x=10,S={position:"absolute",outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",width:x,height:x},ut=()=>X(b.exports.Fragment,{children:[p("div",{"data-dir":"s","data-ord":"s",style:w(u({},S),{bottom:0,left:"50%",marginBottom:-1*x/2,marginLeft:-1*x/2,cursor:"s-resize"})}),p("div",{"data-dir":"n","data-ord":"n",style:w(u({},S),{top:0,left:"50%",marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"n-resize"})}),p("div",{"data-dir":"w","data-ord":"w",style:w(u({},S),{top:"50%",left:0,marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"w-resize"})}),p("div",{"data-dir":"e","data-ord":"e",style:w(u({},S),{top:"50%",right:0,marginTop:-1*x/2,marginRight:-1*x/2,cursor:"e-resize"})}),p("div",{"data-dir":"se","data-ord":"se",style:w(u({},S),{bottom:0,right:0,marginBottom:-1*x/2,marginRight:-1*x/2,cursor:"se-resize"})}),p("div",{"data-dir":"sw","data-ord":"sw",style:w(u({},S),{bottom:0,left:0,marginBottom:-1*x/2,marginLeft:-1*x/2,cursor:"sw-resize"})}),p("div",{"data-dir":"nw","data-ord":"nw",style:w(u({},S),{top:0,left:0,marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"nw-resize"})}),p("div",{"data-dir":"ne","data-ord":"ne",style:w(u({},S),{top:0,right:0,marginTop:-1*x/2,marginRight:-1*x/2,cursor:"ne-resize"})})]}),gt=({area:t,onCropStart:e,showHandles:s,globalAreaStyle:A,customAreaRenderer:C,areaNumber:Y})=>{const g={top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`};return X("div",{style:u(u(u({position:"absolute",border:"1px dashed rgba(0,0,0,0.5)",outline:"1px dashed rgba(255,255,255,0.5)",cursor:"move",boxSizing:"border-box",touchAction:"none"},g),A),t.areaStyle),onPointerDown:e,"data-wrapper":"wrapper",children:[C?C(w(u({},t),{areaNumber:Y})):null,s?p(ut,{}):null]})},xt=({areas:t})=>p("table",{style:{position:"absolute",right:0,top:0},children:p("tbody",{children:t.map((e,s)=>X("tr",{children:[X("td",{children:["x: ",Math.round(e.x)]}),X("td",{children:["y: ",Math.round(e.y)]}),X("td",{children:["width: ",Math.round(e.width)]}),X("td",{children:["height: ",Math.round(e.height)]}),X("td",{children:["unit: ",e.unit]})]},s))})}),J=(t,e)=>t===null?!1:e(t)?!0:J(t.parentNode,e),E={capture:!0,passive:!1},ft=["e","w"],pt=["n","s"],wt=["nw","ne","se","sw"],yt=({maxAreas:t=1/0,unit:e="pixel",minWidth:s=0,minHeight:A=0,debug:C=!1,children:Y,areas:g,onChange:f,maxWidth:i,maxHeight:R,wrapperStyle:L,globalAreaStyle:Q,customAreaRenderer:U,mediaWrapperClassName:H})=>{const W=b.exports.useRef(null),_=b.exports.useRef(null),[tt,et]=b.exports.useState(0),[a,P]=b.exports.useState({startClientX:0,startClientY:0,startAreaX:0,startAreaY:0,clientX:0,clientY:0,isResize:!1}),[N,T]=b.exports.useState({areaChangeIndex:0,isChanging:!1}),D=()=>{const n=_.current;if(!n)return{x:0,y:0,width:0,height:0};const{x:l,y:r,width:c,height:o}=n.getBoundingClientRect();return{x:l,y:r,width:c,height:o}},j=b.exports.useCallback(n=>{const l=a.clientX-n.x,c=a.clientY-n.y<a.startAreaY;return l<a.startAreaX?c?"nw":"sw":c?"ne":"se"},[a]),O=b.exports.useCallback(n=>{const l=D();return $(n,l.width,l.height)},[]),it=n=>{const l=n.currentTarget;if(l.dataset.wrapper||l.dataset.direction||J(l,m=>{var v;return(v=m.dataset)==null?void 0:v.wrapper}))return;n.preventDefault(),n.stopPropagation();const r=D(),c=n.clientX-r.x,o=n.clientY-r.y,h={unit:"px",x:c,y:o,width:0,height:0,isChanging:!0,isNew:!0};P({startClientX:n.clientX,startClientY:n.clientY,startAreaX:c,startAreaY:o,clientX:n.clientX,clientY:n.clientY,isResize:!0}),et(tt+1);const y=G(h,r.width,r.height,e);let d;g.length<t?(f(g.concat(y)),d=g.length):(f([...g.slice(0,t-1),y]),d=t-1),T({areaChangeIndex:d,isChanging:!0})},B=b.exports.useCallback(n=>{const l=D(),r=O(n),c=a.clientX-a.startClientX,o=a.clientY-a.startClientY;return r.x=Z(a.startAreaX+c,0,l.width-r.width),r.y=Z(a.startAreaY+o,0,l.height-r.height),r},[a,O]),q=b.exports.useCallback(n=>{const l=D(),r=j(l),c=O(n),o=a.ord?a.ord:r,h=a.clientX-a.startClientX,y=a.clientY-a.startClientY,d={unit:"px",x:0,y:0,width:0,height:0,isChanging:!0,isNew:!1};r==="ne"?(d.x=a.startAreaX,d.width=h,d.height=Math.abs(y),d.y=a.startAreaY-d.height):r==="se"?(d.x=a.startAreaX,d.y=a.startAreaY,d.width=h,d.height=y):r==="sw"?(d.x=a.startAreaX+h,d.y=a.startAreaY,d.width=Math.abs(h),d.height=y):r==="nw"&&(d.x=a.startAreaX+h,d.width=Math.abs(h),d.height=Math.abs(y),d.y=a.startAreaY+y);const m=dt(d,r,l.width,l.height,s,A,i,R);return wt.indexOf(o)>-1?(c.x=m.x,c.y=m.y,c.width=m.width,c.height=m.height):ft.indexOf(o)>-1?(c.x=m.x,c.width=m.width):pt.indexOf(o)>-1&&(c.y=m.y,c.height=m.height),c},[a,j,O,s,A,i,R]),k=b.exports.useCallback(n=>{n.preventDefault(),n.stopPropagation();const{isChanging:l,areaChangeIndex:r}=N;if(!l)return;const c=D(),o=g[r];P(y=>w(u({},y),{clientX:n.clientX,clientY:n.clientY}));let h;if(a.isResize?h=q(o):h=B(o),!ct(o,h)){const y=G(h,c.width,c.height,e);f([...g.slice(0,r),u({},y),...g.slice(r+1)])}},[N,g,a,B,f,e,q]),M=b.exports.useCallback(n=>{n.preventDefault(),n.stopPropagation();const{isChanging:l,areaChangeIndex:r}=N;if(l){T({isChanging:!1,areaChangeIndex:-1}),P({startClientX:0,startClientY:0,startAreaX:0,startAreaY:0,clientX:0,clientY:0,isResize:!1});const c=g[r];f([...g.slice(0,r),w(u({},c),{isNew:!1,isChanging:!1}),...g.slice(r+1)])}},[N,g,f]);b.exports.useEffect(()=>(document.addEventListener("pointermove",k,E),document.addEventListener("pointerup",M,E),document.addEventListener("pointercancel",M,E),()=>{document.removeEventListener("pointermove",k,E),document.removeEventListener("pointerup",M,E),document.removeEventListener("pointercancel",M,E)}),[k,M]);const nt=(n,l)=>{n.preventDefault(),n.stopPropagation();const r=D(),c=g[l],o=$(c,r.width,r.height),h=n.target.dataset.ord,y=Boolean(h);let d=n.clientX,m=n.clientY,v=o.x,z=o.y;h&&(h==="ne"||h=="e"?(v=o.x,z=o.y+o.height):h==="se"||h==="s"?(v=o.x,z=o.y):h==="sw"||h=="w"?(v=o.x+o.width,z=o.y):(h==="nw"||h=="n")&&(v=o.x+o.width,z=o.y+o.height),d=v+r.x,m=z+r.y),P({startClientX:d,startClientY:m,startAreaX:v,startAreaY:z,clientX:n.clientX,clientY:n.clientY,isResize:y,ord:h}),T({isChanging:!0,areaChangeIndex:l})};return X("div",{ref:W,style:u({position:"relative",display:"inline-block",cursor:"crosshair",boxSizing:"border-box",maxWidth:"100%",touchAction:"none"},L),children:[p("div",{ref:_,onPointerDown:it,style:{boxSizing:"border-box"},className:H,children:Y}),g.map((n,l)=>p(gt,{area:n,showHandles:!n.isNew,onCropStart:r=>nt(r,l),globalAreaStyle:Q,customAreaRenderer:U,areaNumber:l+1},l)),C?p(xt,{areas:g}):null]})},K=({maxAreas:t,debug:e,customRenderExampleText:s})=>{const[A,C]=b.exports.useState([]);return p(yt,{onChange:f=>{C(f)},areas:A,maxAreas:t,debug:e,wrapperStyle:{border:"2px solid black"},globalAreaStyle:{border:"1.5px dashed blue",backgroundColor:"lightblue",opacity:"0.5"},customAreaRenderer:f=>{if(!f.isChanging)return X("div",{children:[s," - ",f.areaNumber]},f.areaNumber)},children:p("img",{src:"logo512.png"})})};K.storyName="Area Select";K.args={maxAreas:1,debug:!0,customRenderExampleText:"test"};export{K as AreaSelectExample};
