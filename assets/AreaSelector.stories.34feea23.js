var rt=Object.defineProperty,st=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var V=(t,e,s)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,u=(t,e)=>{for(var s in e||(e={}))at.call(e,s)&&V(t,s,e[s]);if(F)for(var s of F(e))lt.call(e,s)&&V(t,s,e[s]);return t},p=(t,e)=>st(t,ot(e));import{j as X,r as y,a as b}from"./index.58bf200a.js";const I={x:0,y:0,width:0,height:0,unit:"px"};function Z(t,e,s){return Math.min(Math.max(t,e),s)}function ct(t,e){return t.width===e.width&&t.height===e.height&&t.x===e.x&&t.y===e.y&&t.unit===e.unit}const G=(t,e,s,A)=>A==="pixel"?$(t,e,s):ht(t,e,s),ht=(t,e,s)=>t.unit==="%"?p(u(u({},I),t),{unit:"%"}):{unit:"%",x:t.x?t.x/e*100:0,y:t.y?t.y/s*100:0,width:t.width?t.width/e*100:0,height:t.height?t.height/s*100:0};function $(t,e,s){return t.unit?t.unit==="px"?p(u(u({},I),t),{unit:"px"}):{unit:"px",x:t.x?t.x*e/100:0,y:t.y?t.y*s/100:0,width:t.width?t.width*e/100:0,height:t.height?t.height*s/100:0}:p(u(u({},I),t),{unit:"px"})}function dt(t,e,s,A,C=0,Y=0,g=s,f=A){const n=u({},t);n.y<0&&(n.height=Math.max(n.height+n.y,Y),n.y=0),n.x<0&&(n.width=Math.max(n.width+n.x,C),n.x=0);const R=s-(n.x+n.width);R<0&&(n.x=Math.min(n.x,s-C),n.width+=R);const L=A-(n.y+n.height);return L<0&&(n.y=Math.min(n.y,A-Y),n.height+=L),n.width<C&&((e==="sw"||e=="nw")&&(n.x-=C-n.width),n.width=C),n.height<Y&&((e==="nw"||e=="ne")&&(n.y-=Y-n.height),n.height=Y),n.width>g&&((e==="sw"||e=="nw")&&(n.x-=g-n.width),n.width=g),n.height>f&&((e==="nw"||e=="ne")&&(n.y-=f-n.height),n.height=f),n}const x=10,S={position:"absolute",outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",width:x,height:x},ut=({area:t,onCropStart:e,showHandles:s,globalAreaStyle:A,customAreaRenderer:C,areaNumber:Y})=>{const g={top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`};return X("div",{style:u(u(u({position:"absolute",border:"1px dashed rgba(0,0,0,0.5)",outline:"1px dashed rgba(255,255,255,0.5)",cursor:"move",boxSizing:"border-box",touchAction:"none"},g),A),t.areaStyle),onPointerDown:e,"data-wrapper":"wrapper",children:[C?C(p(u({},t),{areaNumber:Y})):null,s?X(y.exports.Fragment,{children:[b("div",{"data-dir":"s","data-ord":"s",style:p(u({},S),{bottom:0,left:"50%",marginBottom:-1*x/2,marginLeft:-1*x/2,cursor:"s-resize"})}),b("div",{"data-dir":"n","data-ord":"n",style:p(u({},S),{top:0,left:"50%",marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"n-resize"})}),b("div",{"data-dir":"w","data-ord":"w",style:p(u({},S),{top:"50%",left:0,marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"w-resize"})}),b("div",{"data-dir":"e","data-ord":"e",style:p(u({},S),{top:"50%",right:0,marginTop:-1*x/2,marginRight:-1*x/2,cursor:"e-resize"})}),b("div",{"data-dir":"se","data-ord":"se",style:p(u({},S),{bottom:0,right:0,marginBottom:-1*x/2,marginRight:-1*x/2,cursor:"se-resize"})}),b("div",{"data-dir":"sw","data-ord":"sw",style:p(u({},S),{bottom:0,left:0,marginBottom:-1*x/2,marginLeft:-1*x/2,cursor:"sw-resize"})}),b("div",{"data-dir":"nw","data-ord":"nw",style:p(u({},S),{top:0,left:0,marginTop:-1*x/2,marginLeft:-1*x/2,cursor:"nw-resize"})}),b("div",{"data-dir":"ne","data-ord":"ne",style:p(u({},S),{top:0,right:0,marginTop:-1*x/2,marginRight:-1*x/2,cursor:"ne-resize"})})]}):null]})},J=(t,e)=>t===null?!1:e(t)?!0:J(t.parentNode,e),E={capture:!0,passive:!1},gt=["e","w"],xt=["n","s"],ft=["nw","ne","se","sw"],pt=({maxAreas:t=1/0,unit:e="pixel",minWidth:s=0,minHeight:A=0,debug:C=!1,children:Y,areas:g,onChange:f,maxWidth:n,maxHeight:R,wrapperStyle:L,globalAreaStyle:Q,customAreaRenderer:U,mediaWrapperClassName:H})=>{const W=y.exports.useRef(null),_=y.exports.useRef(null),[tt,et]=y.exports.useState(0),[l,P]=y.exports.useState({startClientX:0,startClientY:0,startAreaX:0,startAreaY:0,clientX:0,clientY:0,isResize:!1}),[N,T]=y.exports.useState({areaChangeIndex:0,isChanging:!1}),D=()=>{const i=_.current;if(!i)return{x:0,y:0,width:0,height:0};const{x:o,y:r,width:c,height:a}=i.getBoundingClientRect();return{x:o,y:r,width:c,height:a}},j=y.exports.useCallback(i=>{const o=l.clientX-i.x,c=l.clientY-i.y<l.startAreaY;return o<l.startAreaX?c?"nw":"sw":c?"ne":"se"},[l]),O=y.exports.useCallback(i=>{const o=D();return $(i,o.width,o.height)},[]),it=i=>{const o=i.currentTarget;if(o.dataset.wrapper||o.dataset.direction||J(o,m=>{var v;return(v=m.dataset)==null?void 0:v.wrapper}))return;i.preventDefault(),i.stopPropagation();const r=D(),c=i.clientX-r.x,a=i.clientY-r.y,h={unit:"px",x:c,y:a,width:0,height:0,isChanging:!0,isNew:!0};P({startClientX:i.clientX,startClientY:i.clientY,startAreaX:c,startAreaY:a,clientX:i.clientX,clientY:i.clientY,isResize:!0}),et(tt+1);const w=G(h,r.width,r.height,e);let d;g.length<t?(f(g.concat(w)),d=g.length):(f([...g.slice(0,t-1),w]),d=t-1),T({areaChangeIndex:d,isChanging:!0})},B=y.exports.useCallback(i=>{const o=D(),r=O(i),c=l.clientX-l.startClientX,a=l.clientY-l.startClientY;return r.x=Z(l.startAreaX+c,0,o.width-r.width),r.y=Z(l.startAreaY+a,0,o.height-r.height),r},[l,O]),q=y.exports.useCallback(i=>{const o=D(),r=j(o),c=O(i),a=l.ord?l.ord:r,h=l.clientX-l.startClientX,w=l.clientY-l.startClientY,d={unit:"px",x:0,y:0,width:0,height:0,isChanging:!0,isNew:!1};r==="ne"?(d.x=l.startAreaX,d.width=h,d.height=Math.abs(w),d.y=l.startAreaY-d.height):r==="se"?(d.x=l.startAreaX,d.y=l.startAreaY,d.width=h,d.height=w):r==="sw"?(d.x=l.startAreaX+h,d.y=l.startAreaY,d.width=Math.abs(h),d.height=w):r==="nw"&&(d.x=l.startAreaX+h,d.width=Math.abs(h),d.height=Math.abs(w),d.y=l.startAreaY+w);const m=dt(d,r,o.width,o.height,s,A,n,R);return ft.indexOf(a)>-1?(c.x=m.x,c.y=m.y,c.width=m.width,c.height=m.height):gt.indexOf(a)>-1?(c.x=m.x,c.width=m.width):xt.indexOf(a)>-1&&(c.y=m.y,c.height=m.height),c},[l,j,O,s,A,n,R]),k=y.exports.useCallback(i=>{i.preventDefault(),i.stopPropagation();const{isChanging:o,areaChangeIndex:r}=N;if(!o)return;const c=D(),a=g[r];P(w=>p(u({},w),{clientX:i.clientX,clientY:i.clientY}));let h;if(l.isResize?h=q(a):h=B(a),!ct(a,h)){const w=G(h,c.width,c.height,e);f([...g.slice(0,r),u({},w),...g.slice(r+1)])}},[N,g,l,B,f,e,q]),M=y.exports.useCallback(i=>{i.preventDefault(),i.stopPropagation();const{isChanging:o,areaChangeIndex:r}=N;if(o){T({isChanging:!1,areaChangeIndex:-1}),P({startClientX:0,startClientY:0,startAreaX:0,startAreaY:0,clientX:0,clientY:0,isResize:!1});const c=g[r];f([...g.slice(0,r),p(u({},c),{isNew:!1,isChanging:!1}),...g.slice(r+1)])}},[N,g,f]);y.exports.useEffect(()=>(document.addEventListener("pointermove",k,E),document.addEventListener("pointerup",M,E),document.addEventListener("pointercancel",M,E),()=>{document.removeEventListener("pointermove",k,E),document.removeEventListener("pointerup",M,E),document.removeEventListener("pointercancel",M,E)}),[k,M]);const nt=(i,o)=>{i.preventDefault(),i.stopPropagation();const r=D(),c=g[o],a=$(c,r.width,r.height),h=i.target.dataset.ord,w=Boolean(h);let d=i.clientX,m=i.clientY,v=a.x,z=a.y;h&&(h==="ne"||h=="e"?(v=a.x,z=a.y+a.height):h==="se"||h==="s"?(v=a.x,z=a.y):h==="sw"||h=="w"?(v=a.x+a.width,z=a.y):(h==="nw"||h=="n")&&(v=a.x+a.width,z=a.y+a.height),d=v+r.x,m=z+r.y),P({startClientX:d,startClientY:m,startAreaX:v,startAreaY:z,clientX:i.clientX,clientY:i.clientY,isResize:w,ord:h}),T({isChanging:!0,areaChangeIndex:o})};return X("div",{ref:W,style:u({position:"relative",display:"inline-block",cursor:"crosshair",boxSizing:"border-box",maxWidth:"100%",touchAction:"none"},L),children:[b("div",{ref:_,onPointerDown:it,style:{boxSizing:"border-box"},className:H,children:Y}),g.map((i,o)=>b(ut,{area:i,showHandles:!i.isNew,onCropStart:r=>nt(r,o),globalAreaStyle:Q,customAreaRenderer:U,areaNumber:o+1},o)),C?b("table",{style:{position:"absolute",right:0,top:0},children:b("tbody",{children:g.map((i,o)=>X("tr",{children:[X("td",{children:["x: ",Math.round(i.x)]}),X("td",{children:["y: ",Math.round(i.y)]}),X("td",{children:["width: ",Math.round(i.width)]}),X("td",{children:["height: ",Math.round(i.height)]}),X("td",{children:["unit: ",i.unit]})]},o))})}):null]})},K=({maxAreas:t,debug:e,customRenderExampleText:s})=>{const[A,C]=y.exports.useState([]);return b(pt,{onChange:f=>{C(f)},areas:A,maxAreas:t,debug:e,wrapperStyle:{border:"2px solid black"},globalAreaStyle:{border:"1.5px dashed blue",backgroundColor:"lightblue",opacity:"0.5"},customAreaRenderer:f=>{if(!f.isChanging)return X("div",{children:[s," - ",f.areaNumber]},f.areaNumber)},children:b("img",{src:"logo512.png"})})};K.storyName="Area Select";K.args={maxAreas:1,debug:!0,customRenderExampleText:"test"};export{K as AreaSelectExample};
